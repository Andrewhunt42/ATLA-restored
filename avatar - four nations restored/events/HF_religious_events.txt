# Written by Flavio

namespace = HF
namespace = HFP

#On Conversion event to clear up gender laws when needed.
character_event = {
	id = HF.23034
	hide_window = yes
	
	trigger = {
		ROOT = {
			OR = { 
				has_religion_feature = religion_patriarchal
				has_religion_feature = religion_equal
				has_religion_feature = religion_matriarchal
			}
		}
	}
	is_triggered_only = yes
	
	immediate = { 
		if = {
			limit = { 
				ROOT = { 
					has_religion_feature = religion_matriarchal 
					NOR = {  
						#is_merchant_republic = yes
						is_republic = yes
					}
				}
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = enatic_succession
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = status_of_women_4
						cooldown = no
						opinion_effect = no
					}
					if = { 
						limit = { 
							ROOT = { 
								OR = { 
									is_feudal = yes 
									is_tribal = yes
									is_nomadic = yes
								}
							}
						}
						add_law = {
							law = succ_turkish_succession
							cooldown = no
							opinion_effect = no
						}
					}
				} 
				recalc_succession = yes
			} 
		}
		if = {
			limit = { 
				ROOT = { has_religion_feature = religion_patriarchal }
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = agnatic_succession
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = status_of_women_0
						cooldown = no
						opinion_effect = no
					}
					if = { 
						limit = { 
							ROOT = { 
								OR = { 
									is_feudal = yes 
									is_tribal = yes
									is_nomadic = yes
								}
							}
						}
						add_law = {
							law = succ_turkish_succession
							cooldown = no
							opinion_effect = no
						}
					}
				} 
				recalc_succession = yes
			} 
		}
		if = {
			limit = { 
				ROOT = {
					has_religion_feature = religion_equal 
					NOR = {  
						#is_merchant_republic = yes
						is_republic = yes
					}
				}
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = true_cognatic_succession
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = status_of_women_4
						cooldown = no
						opinion_effect = no
					}
				} 
				recalc_succession = yes
			} 
		}
		ROOT = {
			if = {
				limit = { 
					FROM = {
						NOR = { 
							has_religion_feature = religion_equal 
							has_religion_feature = religion_patriarchal
							has_religion_feature = religion_matriarchal
						}
					}
					ROOT = { has_religion_feature = religion_matriarchal }
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
			if = {
				limit = { 
					FROM = {
						NOR = { 
							has_religion_feature = religion_equal 
							has_religion_feature = religion_matriarchal
							has_religion_feature = religion_patriarchal
						}
					}
					ROOT = { has_religion_feature = religion_patriarchal }
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
			if = {
				limit = { 
					FROM = { has_religion_feature = religion_patriarchal }
					ROOT = { 
						OR = { 
							has_religion_feature = religion_equal 
							has_religion_feature = religion_matriarchal
						}
					}
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
			if = {
				limit = { 
					FROM = { has_religion_feature = religion_matriarchal }
					ROOT = { 
						OR = { 
							has_religion_feature = religion_equal 
							has_religion_feature = religion_patriarchal
						}
					}
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
			if = {
				limit = { 
					FROM = { 
						has_religion_feature = religion_equal 
					}
					ROOT = { 
						has_religion_feature = religion_patriarchal
					}
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
			if = {
				limit = { 
					FROM = { 
						has_religion_feature = religion_equal 
					}
					ROOT = { 
						has_religion_feature = religion_matriarchal
					}
				}
				any_close_relative = { 
					limit = { is_female = no }
					opinion = { 
						who = ROOT 
						modifier = bad_succ_law_change
						years = 100
					}
				}
				any_close_relative = { 
					limit = { is_female = yes }
					opinion = { 
						who = ROOT 
						modifier = good_succ_law_change
						years = 100
					}
				}
			}
		}
	}
}

#On Random Start cleanup for Status of Women.
character_event = {
	id = HF.23035
	hide_window = yes
	
	trigger = { 
		is_save_game = no

		OR = { 
			has_religion_feature = religion_patriarchal
			has_religion_feature = religion_equal
			has_religion_feature = religion_matriarchal
		}
	}
	is_triggered_only = yes
	
	immediate = { 
		if = {
			limit = { 
				ROOT = { has_religion_feature = religion_matriarchal }
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = status_of_women_4
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = enatic_succession
						cooldown = no
						opinion_effect = no
					}
					if = { 
						limit = { 
							ROOT = { 
								OR = { 
									is_feudal = yes 
									is_tribal = yes
									is_nomadic = yes
								}
							}
						}
						add_law = {
							law = succ_turkish_succession
							cooldown = no
							opinion_effect = no
						}
					}
				} 
			} 
		}
		if = {
			limit = { 
				ROOT = { has_religion_feature = religion_patriarchal }
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = status_of_women_0
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = cognatic_succession
						cooldown = no
						opinion_effect = no
					}
					if = { 
						limit = { 
							ROOT = { 
								OR = { 
									is_feudal = yes 
									is_tribal = yes
									is_nomadic = yes
								}
							}
						}
						add_law = {
							law = succ_turkish_succession
							cooldown = no
							opinion_effect = no
						}
					}
				}
			} 
		}
		if = {
			limit = { 
				ROOT = {
					has_religion_feature = religion_equal 
				}
			}
			ROOT = { 
				any_demesne_title = { 
					add_law = {
						law = status_of_women_4
						cooldown = no
						opinion_effect = no
					}
					add_law = {
						law = true_cognatic_succession
						cooldown = no
						opinion_effect = no
					}
				} 
			} 
		}
	}
}

#Notification event for county owner if different from user
character_event = {
	id = HF.23125
	picture = GFX_evt_hippodrome_byzantine
	desc = EVTDESCHF23125
	border = GFX_event_normal_frame_diplomacy
	
	is_triggered_only = yes
	
	option = {
		name = I_SEE
	}
}

#Gained the Haemophiliac trait.
character_event = {
	id = HF.23431
	desc = EVTDESCAHF23431
	picture = GFX_evt_pagan_blood_sacrifice
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	trigger = {
		NOT = { trait = bloodthirsty_gods_1 }
		has_religion_feature = religion_ritual_sacrifice
	}

	immediate = { 
		add_blood_splatter_effect = yes
		add_trait = bloodthirsty_gods_1
	}

	option = { 
		name = EVTOPTAHF23431
		add_trait = bloodthirsty_gods_1
		if = { 
			limit = { NOR = { trait = kind trait = cruel } } 
			random = { 
				chance = 25 
				add_trait = cruel 
				hidden_tooltip = { character_event = { id = 38259 } }
			} 
		} 
		if = { 
			limit = { trait = kind } 
			random = { 
				chance = 25 
				remove_trait = kind 
				hidden_tooltip = { character_event = { id = 38307 } }
			} 
		} 
		if = { 
			limit = { trait = cynical } 
			random = { chance = 25 remove_trait = cynical } 
		}
	}
}
#Gained the Haemophant trait.
character_event = {
	id = HF.23432
	desc = EVTDESCAHF23432
	picture = GFX_evt_pagan_blood_sacrifice
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	trigger = {
		has_religion_feature = religion_ritual_sacrifice
		NOR = { 
			trait = bloodthirsty_gods_2 
			trait = bloodthirsty_gods_3
		}
	}
	
	immediate = { 
		add_blood_splatter_effect = yes
		add_trait = bloodthirsty_gods_2
	}

	option = { 
		name = EVTOPTAHF23432
		if = { 
			limit = { trait = bloodthirsty_gods_1 } 
			remove_trait = bloodthirsty_gods_1
		} 
		add_trait = bloodthirsty_gods_2
		if = { 
			limit = { NOR = { trait = kind trait = cruel } } 
			random = { 
				chance = 50 
				add_trait = cruel 
				hidden_tooltip = { character_event = { id = 38259 } }
			} 
		} 
		if = { 
			limit = { trait = kind } 
			random = { 
				chance = 50 
				remove_trait = kind 
				hidden_tooltip = { character_event = { id = 38307 } }
			} 
		}
		if = { 
			limit = { trait = cynical } 
			random = { 
				chance = 50 
				remove_trait = cynical 
			} 
		}
	}
}
#Gained the Haemoarch trait.
character_event = {
	id = HF.23433
	desc = EVTDESCAHF23433
	picture = GFX_evt_pagan_blood_sacrifice
	border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes

	trigger = {
		has_religion_feature = religion_ritual_sacrifice
		NOT = { 
			trait = bloodthirsty_gods_3
		}
	}
	immediate = { 
		add_blood_splatter_effect = yes
		add_trait = bloodthirsty_gods_3
	}

	option = { 
		name = EVTOPTAHF23433
		if = { 
			limit = { trait = bloodthirsty_gods_1 } 
			remove_trait = bloodthirsty_gods_1
		} 
		if = { 
			limit = { trait = bloodthirsty_gods_2 } 
			remove_trait = bloodthirsty_gods_2
		} 
		add_trait = bloodthirsty_gods_3
		if = { 
			limit = { NOR = { trait = kind trait = cruel } } 
			random = { 
				chance = 75 
				add_trait = cruel 
				hidden_tooltip = { character_event = { id = 38259 } }
			} 
		}
		if = { 
			limit = { trait = kind } 
			remove_trait = kind
		}
		if = { 
			limit = { trait = cynical } 
			remove_trait = cynical
		}
	}
}
#Gained the Bloodthirsty Bloodline.
narrative_event = {
	id = HF.23434
	title = EVTTITLE23434
	desc = EVTDESCAHF23434
	picture = GFX_evt_pagan_blood_sacrifice
	border = GFX_event_narrative_frame_religion
	sound = bloodline_added
	
	is_triggered_only = yes

	trigger = {
		has_religion_feature = religion_ritual_sacrifice
		NOT = { 
			any_owned_bloodline = { # Not already has a Bloodthirsty bloodline.
				has_bloodline_flag = bloodline_created_bloodthirsty
			}
		}
	}

	immediate = { 
		add_blood_splatter_effect = yes
		if = {
			limit = {
				ai = no
			}
			set_character_flag = achievement_bloody_line
		}
	}

	option = {
		name = EVTOPTAHF23434
		hidden_tooltip = { 
			if = { 
				limit = { this_has_super_cool_nickname_trigger = no }
				random_list = { 
					20 = { 
						give_nickname = nick_the_red_storm 
					} 
					20 = { 
						give_nickname = nick_the_scarlet_hands 
					} 
					20 = { 
						give_nickname = nick_the_blood_monger 
					} 
					20 = { 
						give_nickname = nick_the_black_skull 
					} 
					20 = { 
						give_nickname = nick_the_heart_eater 
					} 
					20 = { 
						give_nickname = nick_the_slaughterer 
					} 
					20 = { 
						give_nickname = nick_the_soul_flayer
					} 
					20 = { 
						give_nickname = nick_the_spirit_stalker 
					} 
					10 = { 
						give_nickname = nick_the_crimson_reaper 
					} 
					10 = { 
						give_nickname = nick_the_dreaded
					} 
					5 = { 
						give_nickname = nick_the_chest_buster 
					} 
				}
			}
		}
		if = { 
			limit = { is_female = no }
			create_bloodline = {
				type = bloodthirsty_male_bloodline
			}
			new_bloodline = {
				set_description = "bloodline_desc_bloodthirsty_gods_bloodline"
				random_list = { 
					20 = { set_name = bloodline_bloodthirsty_name_random_a } #Randomize names to avoid too much repetition.
					20 = { set_name = bloodline_bloodthirsty_name_random_b }
					20 = { set_name = bloodline_bloodthirsty_name_random_c }
					20 = { set_name = bloodline_bloodthirsty_name_random_d } 
					20 = { set_name = bloodline_bloodthirsty_name_random_e } 
					20 = { set_name = bloodline_bloodthirsty_name_random_f } 
				}
			}
		}
		if = { 
			limit = { is_female = yes }
			create_bloodline = {
				type = bloodthirsty_female_bloodline
			}
			new_bloodline = {
				set_description = "bloodline_desc_bloodthirsty_gods_bloodline"
				random_list = { 
					20 = { set_name = bloodline_bloodthirsty_name_random_a } #Randomize names to avoid too much repetition.
					20 = { set_name = bloodline_bloodthirsty_name_random_b }
					20 = { set_name = bloodline_bloodthirsty_name_random_c }
					20 = { set_name = bloodline_bloodthirsty_name_random_d } 
					20 = { set_name = bloodline_bloodthirsty_name_random_e } 
					20 = { set_name = bloodline_bloodthirsty_name_random_f } 
				}
			}		
		}
		hidden_tooltip = { 
			any_player = { 
				limit = { 
					NOT = { character = ROOT }
					is_within_diplo_range = ROOT
				}
				narrative_event = { id = HF.23435 }
			}
		}
	}
}

#Inform players.
narrative_event = {
	id = HF.23435
	title = EVTTITLE23435
	desc = EVTDESCBHF23435
	picture = GFX_evt_pagan_blood_sacrifice
	border = GFX_event_narrative_frame_religion
	
	is_triggered_only = yes

	option = { 
		name = EVTOPTAHF23435
		trigger = { 
			OR = {
				religion = FROM
				has_religion_feature = religion_ritual_sacrifice
			}
		}
	}
	option = { 
		name = EVTOPTBHF23435
		trigger = { 
			NOR = {
				religion = FROM
				has_religion_feature = religion_ritual_sacrifice
			}
		}
	}
}
